"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9671],{7876:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=t(5893),o=t(1151);const s={sidebar_position:0},l="Getting Started",i={id:"intro",title:"Getting Started",description:"Quick install",source:"@site/docs/intro.md",sourceDirName:".",slug:"/intro",permalink:"/docs/intro",draft:!1,unlisted:!1,editUrl:"https://github.com/finom/vovk/tree/main/docs/docs/intro.md",tags:[],version:"current",sidebarPosition:0,frontMatter:{sidebar_position:0},sidebar:"tutorialSidebar",previous:{title:"About",permalink:"/docs/about"},next:{title:"Controller Class",permalink:"/docs/controller"}},a={},c=[{value:"Quick install",id:"quick-install",level:2},{value:"Manual install",id:"manual-install",level:2},{value:"1. Create Next.js project with App Router and install Vovk.ts",id:"1-create-nextjs-project-with-app-router-and-install-vovkts",level:3},{value:"2. Enable decorators",id:"2-enable-decorators",level:3},{value:"3. Set up Next.js wildcard route handler and export types read by the client library",id:"3-set-up-nextjs-wildcard-route-handler-and-export-types-read-by-the-client-library",level:3},{value:"4. Create first controller and add it to the controller object",id:"4-create-first-controller-and-add-it-to-the-controller-object",level:3},{value:"Create a React component and run <code>vovk dev</code>",id:"create-a-react-component-and-run-vovk-dev",level:2},{value:"Build and deploy",id:"build-and-deploy",level:2},{value:"Examples",id:"examples",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"getting-started",children:"Getting Started"}),"\n",(0,r.jsx)(n.h2,{id:"quick-install",children:"Quick install"}),"\n",(0,r.jsxs)(n.p,{children:["Setup Vovk.ts with ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/create-next-app",children:"create-next-app"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"npx create-next-app -e https://github.com/finom/vovk-hello-world\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Inside the project folder run ",(0,r.jsx)(n.code,{children:"npm run dev"})," and open ",(0,r.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"manual-install",children:"Manual install"}),"\n",(0,r.jsx)(n.h3,{id:"1-create-nextjs-project-with-app-router-and-install-vovkts",children:"1. Create Next.js project with App Router and install Vovk.ts"}),"\n",(0,r.jsxs)(n.p,{children:["Follow ",(0,r.jsx)(n.a,{href:"https://nextjs.org/docs/getting-started/installation",children:"this instruction"})," to install Next.js. Use TypeScript, App Router and ",(0,r.jsx)(n.code,{children:"src/"})," directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"npx create-next-app\n"})}),"\n",(0,r.jsx)(n.p,{children:"Choices example:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://github.com/finom/vovk/assets/1082083/b9e600da-a43a-4e30-a089-43e5e4b147ef",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"At the newly created folder run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"npm i vovk vovk-client\n"})}),"\n",(0,r.jsx)(n.p,{children:"or"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"yarn add vovk vovk-client\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-enable-decorators",children:"2. Enable decorators"}),"\n",(0,r.jsxs)(n.p,{children:["In your ",(0,r.jsx)(n.strong,{children:"tsconfig.json"})," set ",(0,r.jsx)(n.code,{children:'"experimentalDecorators"'})," to ",(0,r.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "compilerOptions": {\n        "experimentalDecorators": true,\n        // ...\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-set-up-nextjs-wildcard-route-handler-and-export-types-read-by-the-client-library",children:"3. Set up Next.js wildcard route handler and export types read by the client library"}),"\n",(0,r.jsxs)(n.p,{children:["Create file ",(0,r.jsx)(n.strong,{children:"/src/app/api/[[...vovk]]/route.ts"})," where ",(0,r.jsx)(n.strong,{children:"[[...vovk]]"})," is a folder name insicating what Next.js documentation calls ",(0,r.jsx)(n.a,{href:"https://nextjs.org/docs/pages/building-your-application/routing/dynamic-routes#optional-catch-all-segments",children:'"Optional Catch-all Segment"'})," that ",(0,r.jsx)(n.a,{href:"./customization",children:"can be customized"}),". This is the core entry point for all ",(0,r.jsx)(n.strong,{children:"Vovk.ts"})," routes."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// /src/app/api/[[...vovk]]/route.ts\nimport { initVovk } from 'vovk';\n\nexport const runtime = 'edge';\n\nconst controllers = {};\nconst workers = {};\n\n// export types used by the client\nexport type Controllers = typeof controllers;\nexport type Workers = typeof workers;\n\nexport const { GET, POST, PUT, DELETE } = initVovk({ controllers, workers });\n"})}),"\n",(0,r.jsx)(n.p,{children:"Enabling Edge Runtime is optional."}),"\n",(0,r.jsx)(n.h3,{id:"4-create-first-controller-and-add-it-to-the-controller-object",children:"4. Create first controller and add it to the controller object"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"HelloController.ts"})," at ",(0,r.jsx)(n.strong,{children:"/src/modules/hello/"})," with same-named static class."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// /src/modules/hello/HelloController.ts\nimport { get, prefix } from \"vovk\";\n\n@prefix('hello') // prefix is optional\nexport default class HelloController {\n    @get('greeting')\n    static getHello() {\n        return { greeting: 'Hello world!' };\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["And add this class at ",(0,r.jsx)(n.strong,{children:"/src/app/api/[[...vovk]]/route.ts"})," to the ",(0,r.jsx)(n.code,{children:"controllers"})," object."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// /src/app/api/[[...vovk]]/route.ts\nimport HelloController from '../../../modules/hello/HelloController';\n\n// ...\nconst controllers = { HelloController };\n// ...\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The code above creates GET endpoint to ",(0,r.jsx)(n.code,{children:"/api/hello/greeting"}),". You can also use named export for the controller if needed."]}),"\n",(0,r.jsxs)(n.h2,{id:"create-a-react-component-and-run-vovk-dev",children:["Create a React component and run ",(0,r.jsx)(n.code,{children:"vovk dev"})]}),"\n",(0,r.jsxs)(n.p,{children:["Once you run ",(0,r.jsx)(n.code,{children:"npx vovk dev"})," that replaces the original ",(0,r.jsx)(n.code,{children:"npx next dev"})," you're going to notice the new file ",(0,r.jsx)(n.strong,{children:".vovk.json"})," created in the root of your project. This file contains required information to build the client and it needs to be committed. It's going to be updated automatically when your project structure is changed. Open ",(0,r.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you can use ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/concurrently",children:"concurrently"})," to avoid using the wrapper. Use ",(0,r.jsx)(n.code,{children:"--no-next-dev"})," in order to avoid running ",(0,r.jsx)(n.code,{children:"next dev"})," internally and provide ",(0,r.jsx)(n.code,{children:"PORT"})," variable explicitly: ",(0,r.jsx)(n.code,{children:"PORT=3000 concurrently 'vovk dev --no-next-dev' 'next dev' --kill-others"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Besides ",(0,r.jsx)(n.strong,{children:".vovk.json"})," the command also generates client ",(0,r.jsx)(n.strong,{children:".js"})," and ",(0,r.jsx)(n.strong,{children:".ts"})," files inside ",(0,r.jsx)(n.strong,{children:"node_modules/.vovk"})," that are re-exported by ",(0,r.jsx)(n.strong,{children:"vovk-client"})," module to produce no errors if ",(0,r.jsx)(n.strong,{children:"vovk-client"})," is not installed. This approach is borrowed from Prisma ORM."]}),"\n",(0,r.jsxs)(n.p,{children:["Now the client is generated you can safely import your client library from ",(0,r.jsx)(n.strong,{children:"vovk-client"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"'use client';\nimport { useState } from 'react';\nimport { HelloController } from 'vovk-client';\nimport type { VovkClientReturnType } from 'vovk';\n\nexport default function MyComponent() {\n  const [serverResponse, setServerResponse] = useState<VovkClientReturnType<typeof HelloController.getHello>>();\n\n  return (\n    <>\n      <button\n        onClick={async () => {\n          const response = await HelloController.getHello();\n          setServerResponse(response);\n        }}\n      >\n        Get Greeting from Server\n      </button>\n      <div>{serverResponse?.greeting}</div>\n    </>\n  );\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note that if you're using VSCode you're probably going to need to ",(0,r.jsx)(n.a,{href:"https://stackoverflow.com/questions/64454845/where-is-vscodes-restart-ts-server",children:"restart TS server"})," each time when you add a new controller or worker service to your app because by the time being TS Server doesn't update types imported from ",(0,r.jsx)(n.strong,{children:"node_modules"})," automatically when they were changed. This is a well-known problem that bothers Prisma ORM developers for long time. In all other scenarios (when you add a new method, change body type, etc) you don't need to do that since TS server reads ",(0,r.jsx)(n.code,{children:"Controllers"})," and ",(0,r.jsx)(n.code,{children:"Workers"})," that you export from ",(0,r.jsx)(n.strong,{children:"/src/app/api/[[...vovk]]/route.ts"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Next.js Server Components are also supported but require to define absolute URL (by default all requests are made to ",(0,r.jsx)(n.code,{children:"/api"}),"). Check the ",(0,r.jsx)(n.a,{href:"https://vovk-examples.vercel.app/server-component",children:"Server Component Example"})," for more information."]}),"\n",(0,r.jsx)(n.p,{children:"Methods of the generated library have approximately the following signature:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface Options extends Omit<RequestInit, 'body' | 'method'> {\n  reactNative?: { textStreaming: boolean };\n  prefix?: string;\n  disableClientValidation?: boolean;\n  body: VovkClientBody<typeof Controller.method>\n  params: VovkClientParams<typeof Controller.method>\n  query: VovkClientQuery<typeof Controller.method>\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In other words it supports ",(0,r.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating",children:"custom Next.js options"})," (Because Next.js extends ",(0,r.jsx)(n.code,{children:"RequestInit"})," global type) as well as ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/react-native-fetch-api",children:"React Native Fetch API"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"await HelloController.hello({\n  body: { foo: 'bar' },\n  next: { revalidate: 3600 },\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"build-and-deploy",children:"Build and deploy"}),"\n",(0,r.jsxs)(n.p,{children:["Use the regular ",(0,r.jsx)(n.code,{children:"npx next build"})," to build the project. If the client wasn't generated in ",(0,r.jsx)(n.strong,{children:"node_modules/.vovk"})," before, you going to get compilation errors if ",(0,r.jsx)(n.strong,{children:"vovk-client"})," was imported somewhere in the app. To re-generate client with existing ",(0,r.jsx)(n.strong,{children:".vovk.json"})," without re-builing the project itself you need to run ",(0,r.jsx)(n.code,{children:"npx vovk generate"})," that updates ",(0,r.jsx)(n.strong,{children:"node_modules/.vovk"})," folder on deployment or after you've reinstalled your ",(0,r.jsx)(n.strong,{children:"node_modules"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["To easily build the project on Vercel you can create ",(0,r.jsx)(n.code,{children:'"vercel-build"'})," npm script at ",(0,r.jsx)(n.strong,{children:"package.json"})," that is going to generate client before build."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"scripts": {\n    "vercel-build": "vovk generate && next build"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsxs)(n.p,{children:["You can check more examples ",(0,r.jsx)(n.a,{href:"https://vovk-examples.vercel.app/",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>i,a:()=>l});var r=t(7294);const o={},s=r.createContext(o);function l(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);